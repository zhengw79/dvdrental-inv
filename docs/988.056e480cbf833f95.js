"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[988],{1988:(_e,v,l)=>{l.r(v),l.d(v,{OrderModule:()=>de});var _=l(6895),u=l(5567),e=l(8256),I=l(7064);function q(o,s){1&o&&e._UZ(0,"router-outlet")}let A=(()=>{class o{constructor(){}ngOnInit(){}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-order"]],decls:3,vars:0,consts:[["child",""]],template:function(t,r){1&t&&(e.TgZ(0,"app-main"),e.YNc(1,q,1,0,"ng-template",null,0,e.W1O),e.qZA())},dependencies:[u.lC,I.C]}),o})();var U=l(2340);let N=(()=>{class o{constructor(t){this.router=t;const r=localStorage.getItem("access_token");this.dataTableOption={responsive:!0,processing:!0,serverSide:!0,searching:!1,ajax:{url:`${U.N.apiUrl}graphql`,type:"POST",contentType:"application/json",headers:{authorization:`bearer ${r}`},statusCode:{401:()=>{this.router.navigate(["/auth/login"])}}}}}initCustomersDatatable(){const t=Object.assign({},this.dataTableOption);return t.ajax.data=r=>{const a={operationName:null,query:"query retrieveCustomerDatatablePagination($pageOption: DatatablePaginationInput!){\n          retrieveCustomerDatatablePagination(pageOption: $pageOption) {\n            data { customer_id store_id first_name last_name email create_date address_id address } totalCount } }",variables:{pageOption:{paginate:{page:r.start/r.length,limit:r.length},sort:[{field:r.columns[r.order[0].column].data,order:r.order[0].dir.toUpperCase()}],search:r.search.vale??""}}};return JSON.stringify(a)},t.ajax.dataSrc=r=>{const{data:n,errors:a}=r;if(!a||!a[0]||"Unauthorized"!==a[0].message){const{retrieveCustomerDatatablePagination:d}=n;return r.recordsTotal=d.totalCount,r.recordsFiltered=d.totalCount,d.data}this.router.navigate(["/auth/login"])},t}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(u.F0))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();const S=["customer_tbl"],w=function(){return["/order/customer/create"]};let J=(()=>{class o{constructor(t,r,n){this.datatableService=t,this.router=r,this.ngZone=n,this.$=window.jQuery}ngOnInit(){window.onSelectCustomer=this.onSelectCustomer.bind(this)}ngAfterViewInit(){const t=this.datatableService.initCustomersDatatable();t.columnDefs=[{target:0,data:"customer_id",title:"Id",render:r=>`<button type='button' class='btn btn-primary btn-sm' onClick="onSelectCustomer(${r})"><i class="fas fa-eye"></i></button>`},{target:1,data:"first_name",title:"Customer Name",render:(r,n,a)=>`${r} ${a.last_name}`},{target:2,data:"email",title:"Email"},{target:3,data:"address",title:"Address"},{target:4,data:"store_id",title:"Store Id"}],this.$(this.customer_tbl?.nativeElement).DataTable(t)}onSelectCustomer(t){this.ngZone.run(()=>this.router.navigate([`/order/customer/${t}`]))}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(N),e.Y36(u.F0),e.Y36(e.R0b))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-customers"]],viewQuery:function(t,r){if(1&t&&e.Gf(S,5),2&t){let n;e.iGM(n=e.CRH())&&(r.customer_tbl=n.first)}},hostBindings:function(t,r){1&t&&e.NdJ("onSelectCustomer",function(a){return r.onSelectCustomer(a)},!1,e.Jf7)},decls:15,vars:2,consts:[[1,"d-sm-flex","align-items-center","justify-content-between","mb-4"],[1,"h3","mb-0","text-gray-800"],["type","button",1,"btn","btn-primary",3,"routerLink"],[1,"fas","fa-plus"],[1,"row"],["ckass","col-12 mb-4"],[1,"col-12","mb-4"],[1,"card","shadow"],[1,"card-header"],[1,"card-body"],[1,"datatable"],[1,"display"],["customer_tbl",""]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"h1",1),e._uU(2,"Customers "),e.TgZ(3,"a",2),e._UZ(4,"i",3),e.qZA()()(),e.TgZ(5,"div",4),e._UZ(6,"div",5),e.qZA(),e.TgZ(7,"div",6)(8,"div",7)(9,"div",8),e._uU(10,"Customers"),e.qZA(),e.TgZ(11,"div",9)(12,"div",10),e._UZ(13,"table",11,12),e.qZA()()()()),2&t&&(e.xp6(3),e.Q6J("routerLink",e.DdM(1,w)))},dependencies:[u.yS]}),o})();var c=l(5861),i=l(433),g=l(2284),y=l(4854),h=l(366),C=l(9808),x=l(5136);let O=(()=>{class o extends x.b{retrieveCustomerEntityById(t){var r=this;return(0,c.Z)(function*(){const{data:n,errors:a}=yield(0,C.n)(r.apollo.query({query:h.Ps`query {
        retrieveCustomerEntityById(customer_id: ${t}) {
          customer_id store_id first_name last_name email create_date
          address { address_id address address2 district phone postal_code
            city { city { city_id city }
              country { country_id country }}}
          rentals { rental_id rental_date return_date }
          payments { payment_id payment_date paypal_request_id }
        }}`}));return r.redirectToLoginIfError(a),n.retrieveCustomerEntityById})()}updateCustomerInfo(t){var r=this;return(0,c.Z)(function*(){const{data:n,errors:a}=yield(0,C.n)(r.apollo.query({query:h.Ps`mutation updateCustomerInfo($payload: CustomerInfoInput!) {
        updateCustomerInfo(payload: $payload)
      }`,variables:{payload:t}}));return r.redirectToLoginIfError(a),n.updateCustomerInfo})()}}return o.\u0275fac=function(){let s;return function(r){return(s||(s=e.n5z(o)))(r||o)}}(),o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var Q=l(9688),Y=l(9103);const P=["customer_card_el"],V=["phone_el"],k=["postal_el"],$=["country_el"],E=["city_el"];function F(o,s){1&o&&(e.TgZ(0,"div",37),e._uU(1," Please enter customer's first name. "),e.qZA())}function G(o,s){1&o&&(e.TgZ(0,"div",37),e._uU(1,"Please enter customer's last name."),e.qZA())}function M(o,s){if(1&o&&(e.TgZ(0,"div"),e.YNc(1,G,2,0,"div",16),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",null==t.last_name.errors?null:t.last_name.errors.required)}}function D(o,s){1&o&&(e.TgZ(0,"div",37),e._uU(1,"Please enter customer's email."),e.qZA())}function R(o,s){1&o&&(e.TgZ(0,"div",37),e._uU(1,"Please enter a valid customer's email."),e.qZA())}function z(o,s){if(1&o&&(e.TgZ(0,"div"),e.YNc(1,D,2,0,"div",16),e.YNc(2,R,2,0,"div",16),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",null==t.email.errors?null:t.email.errors.required),e.xp6(1),e.Q6J("ngIf",null==t.email.errors?null:t.email.errors.email)}}function B(o,s){1&o&&(e.TgZ(0,"div",37),e._uU(1,"Please enter the customer's address."),e.qZA())}function j(o,s){if(1&o&&(e.TgZ(0,"div"),e.YNc(1,B,2,0,"div",16),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",null==t.address.errors?null:t.address.errors.required)}}function H(o,s){1&o&&(e.TgZ(0,"div",37),e._uU(1," Please enter customer's district. "),e.qZA())}function L(o,s){if(1&o&&(e.TgZ(0,"div"),e.YNc(1,H,2,0,"div",16),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",null==t.district.errors?null:t.district.errors.required)}}function X(o,s){1&o&&(e.TgZ(0,"div",37),e._uU(1," Please enter customer's phone number. "),e.qZA())}function W(o,s){1&o&&(e.TgZ(0,"div",37),e._uU(1," Please enter a valid phone number. "),e.qZA())}function K(o,s){if(1&o&&(e.TgZ(0,"div"),e.YNc(1,X,2,0,"div",16),e.YNc(2,W,2,0,"div",16),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",null==t.phone.errors?null:t.phone.errors.required),e.xp6(1),e.Q6J("ngIf",null==t.phone.errors?null:t.phone.errors.valid_phone)}}function ee(o,s){1&o&&(e.TgZ(0,"div",37),e._uU(1,"Please enter postal code."),e.qZA())}function te(o,s){1&o&&(e.TgZ(0,"div",37),e._uU(1,"Please enter a valid postal code."),e.qZA())}function re(o,s){if(1&o&&(e.TgZ(0,"div"),e.YNc(1,ee,2,0,"div",16),e.YNc(2,te,2,0,"div",16),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",null==t.postal_code.errors?null:t.postal_code.errors.required),e.xp6(1),e.Q6J("ngIf",null==t.postal_code.errors?null:t.postal_code.errors.valid_postalcode)}}function oe(o,s){1&o&&(e.TgZ(0,"div",37),e._uU(1," Please choose a country. "),e.qZA())}function ne(o,s){1&o&&(e.TgZ(0,"div",37),e._uU(1," Please choose a city. "),e.qZA())}const se=function(){return["/order/customer"]},ie=[{path:"",component:A,children:[{path:"customer",component:J},{path:"customer/:customer_id",component:(()=>{class o{constructor(t,r,n,a){this.orderService=t,this.addressService=r,this._route=n,this.validatorService=a,this.countries=[],this.fg_customer=new i.cw({customer_id:new i.NI(""),address_id:new i.NI(""),first_name:new i.NI("",[i.kI.required]),last_name:new i.NI("",[i.kI.required]),email:new i.NI("",[i.kI.required,i.kI.email]),create_date:new i.NI({disabled:!0,value:""}),address:new i.NI("",[i.kI.required]),address2:new i.NI("",[i.kI.required]),district:new i.NI("",[i.kI.required]),phone:new i.NI("",[i.kI.required,a.phoneNumberValidator]),postal_code:new i.NI("",[i.kI.required,a.postalcodeValidator]),country_id:new i.NI("",[i.kI.required]),city_id:new i.NI({value:"",disabled:!0},i.kI.required)}),this.customer_id=parseInt(n.snapshot.paramMap.get("customer_id")),this.$=window.jQuery}ngOnInit(){}ngAfterViewInit(){var t=this;return(0,c.Z)(function*(){if(t.im_phone=(0,g.ZP)(t.phone_el?.nativeElement,{mask:"(000)000-00-00",lazy:!1,placeholderChar:"_",commit:(r,n)=>{const{unmaskedValue:a}=n;t.phone?.setValue(a)}}),t.im_postal=(0,g.ZP)(t.postal_el?.nativeElement,{mask:"a0a-0a0",lazy:!1,placeholderChar:"#",commit:(r,n)=>{const{unmaskedValue:a}=n;t.postal_code?.setValue(a)}}),yield t.initCountry(),t.customer_id){const r=yield t.orderService.retrieveCustomerEntityById(t.customer_id);t.prefillCustomerForm(r)}})()}prefillCustomerForm(t){const{first_name:r,last_name:n,email:a,create_date:d,address:{address_id:p,address:ue,address2:ce,district:me,phone:Z,postal_code:b,city:{city:{city_id:T},country:{country_id:f}}}}=t;this._customer_id?.setValue(this.customer_id),this.address_id?.setValue(p),this.first_name?.setValue(r),this.last_name?.setValue(n),this.email?.setValue(a),this.create_date?.setValue(d),this.address?.setValue(ue),this.address2?.setValue(ce),this.district?.setValue(me?.toUpperCase()),this.phone?.setValue(Z),this.im_phone.value=Z,this.postal_code?.setValue(b),this.im_postal.value=b,this.country?.setValue(f),this.country?.valueChanges.subscribe(m=>{this.sel_country.val(m).trigger("change"),this.initCity(m)}),this.sel_country?.val(f).trigger("change"),this.city?.setValue(T),this.city?.valueChanges.subscribe(m=>{this.sel_city.val(m).trigger("change")}),this.initCity(f),this.sel_city?.val(T).trigger("change")}initCountry(){var t=this;return(0,c.Z)(function*(){t.$(t.customer_card_el?.nativeElement).block({message:null,css:y.Q});const r=yield t.addressService.retrieveCountryEntities();t.$(t.customer_card_el?.nativeElement).unblock();const n=t.$(t.country_el?.nativeElement);n.hasClass("select2-hidden-accessible")&&(n.empty().trigger("change"),n.select2("destroy")),r&&(t.sel_country=n.select2({data:[{id:"",text:"Please select a country."},...r.map(a=>({id:a.country_id,text:a.country}))]}).on("select2:select",a=>{const{id:d}=a.params.data;t.country?.setValue(+d)}),t.countries=r)})()}initCity(t){const r=this.$(this.city_el?.nativeElement);r.hasClass("select2-hidden-accessible")&&(r.empty().trigger("change"),r.select2("destroy"));const n=this.countries.find(a=>a.country_id===t);if(n){const{cities:a}=n;this.sel_city=r.select2({data:[{id:"",text:"Please select a city."},...a.map(d=>({id:d.city_id,text:d.city}))]}).on("select2:select",d=>{const{id:p}=d.params.data;this.city?.setValue(+p)}),this.city?.enable()}else this.city?.disable()}get address_id(){return this.fg_customer.get("address_id")}get _customer_id(){return this.fg_customer.get("customer_id")}get first_name(){return this.fg_customer.get("first_name")}get last_name(){return this.fg_customer.get("last_name")}get email(){return this.fg_customer.get("email")}get create_date(){return this.fg_customer.get("create_date")}get address(){return this.fg_customer.get("address")}get address2(){return this.fg_customer.get("address2")}get district(){return this.fg_customer.get("district")}get phone(){return this.fg_customer.get("phone")}get postal_code(){return this.fg_customer.get("postal_code")}get country(){return this.fg_customer.get("country_id")}get city(){return this.fg_customer.get("city_id")}onSubmit(){var t=this;return(0,c.Z)(function*(){if(t.fg_customer.markAllAsTouched(),t.fg_customer.invalid)return;const{country_id:r,...n}=t.fg_customer.value;t.$(t.customer_card_el?.nativeElement).block({message:null,css:y.Q}),yield t.orderService.updateCustomerInfo(n),t.$(t.customer_card_el?.nativeElement).unblock()})()}onReset(){this.fg_customer.reset(),this.ngAfterViewInit()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(O),e.Y36(Q.D),e.Y36(u.gz),e.Y36(Y.o))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-customer"]],viewQuery:function(t,r){if(1&t&&(e.Gf(P,5),e.Gf(V,5),e.Gf(k,5),e.Gf($,5),e.Gf(E,5)),2&t){let n;e.iGM(n=e.CRH())&&(r.customer_card_el=n.first),e.iGM(n=e.CRH())&&(r.phone_el=n.first),e.iGM(n=e.CRH())&&(r.postal_el=n.first),e.iGM(n=e.CRH())&&(r.country_el=n.first),e.iGM(n=e.CRH())&&(r.city_el=n.first)}},decls:87,vars:12,consts:[[1,"d-sm-flex","align-items-center","justify-content-between","mb-4"],[1,"h3","mb-0","text-gray-800"],["type","button",1,"btn","btn-primary",3,"routerLink"],[1,"fas","fa-arrow-circle-left"],[1,"row"],[1,"col-lg-6"],[1,"card","shadow","mb-4"],[1,"card-header"],[1,"m-0","font-weight-bold","text-primary"],[1,"card-body"],["customer_card_el",""],[1,"user",3,"formGroup","ngSubmit"],[1,"form-group","row"],[1,"col-sm-6","mb-3","mb-sm-0"],[1,"form-span","mx-2"],["type","text","formControlName","first_name",1,"form-control","form-control-user"],["class","help-error",4,"ngIf"],["type","text","formControlName","last_name",1,"form-control","form-control-user"],[4,"ngIf"],["type","text","formControlName","email",1,"form-control","form-control-user"],["type","text","formControlName","create_date",1,"form-control","form-control-user"],[1,"col-sm-12","mb-3","mb-sm-0"],["type","text","formControlName","address",1,"form-control","form-control-user"],["type","text","formControlName","address2",1,"form-control","form-control-user"],["type","text","formControlName","district",1,"form-control","form-control-user"],["type","text","formControlName","phone",1,"form-control","form-control-user"],["phone_el",""],["type","text","formControlName","postal_code",1,"form-control","form-control-user"],["postal_el",""],["formControlName","country_id",1,"form-control","form-control-user","form-control-select"],["country_el",""],["formControlName","city_id",1,"form-control","form-control-user","form-control-select"],["city_el",""],[1,"form-group","row","mb-3"],[1,"col"],["type","submit",1,"btn","btn-primary","btn-user","btn-block"],["type","button",1,"btn","btn-secondary","btn-user","btn-block",3,"click"],[1,"help-error"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"h1",1)(2,"a",2),e._UZ(3,"i",3),e.qZA(),e._uU(4,"\xa0\xa0Customer & rentals"),e.qZA()(),e.TgZ(5,"div",4)(6,"div",5)(7,"div",6)(8,"div",7)(9,"h6",8),e._uU(10,"Customer Info"),e.qZA()(),e.TgZ(11,"div",9,10)(13,"form",11),e.NdJ("ngSubmit",function(){return r.onSubmit()}),e.TgZ(14,"div",12)(15,"div",13)(16,"label",14),e._uU(17,"First name*"),e.qZA(),e._UZ(18,"input",15),e.YNc(19,F,2,0,"div",16),e.qZA(),e.TgZ(20,"div",13)(21,"label",14),e._uU(22,"Last name*"),e.qZA(),e._UZ(23,"input",17),e.YNc(24,M,2,1,"div",18),e.qZA()(),e.TgZ(25,"div",12)(26,"div",13)(27,"label",14),e._uU(28,"Email*"),e.qZA(),e._UZ(29,"input",19),e.YNc(30,z,3,2,"div",18),e.qZA(),e.TgZ(31,"div",13)(32,"label",14),e._uU(33,"Create date"),e.qZA(),e._UZ(34,"input",20),e.qZA()(),e._UZ(35,"hr"),e.TgZ(36,"div",12)(37,"div",21)(38,"label",14),e._uU(39,"Address*"),e.qZA(),e._UZ(40,"input",22),e.YNc(41,j,2,1,"div",18),e.qZA()(),e.TgZ(42,"div",12)(43,"div",21)(44,"label",14),e._uU(45,"Address 2"),e.qZA(),e._UZ(46,"input",23),e.qZA()(),e.TgZ(47,"div",12)(48,"div",13)(49,"label",14),e._uU(50,"District*"),e.qZA(),e._UZ(51,"input",24),e.YNc(52,L,2,1,"div",18),e.qZA(),e.TgZ(53,"div",13)(54,"label",14),e._uU(55,"Phone number*"),e.qZA(),e._UZ(56,"input",25,26),e.YNc(58,K,3,2,"div",18),e.qZA()(),e.TgZ(59,"div",12)(60,"div",13)(61,"label",14),e._uU(62,"Postal code*"),e.qZA(),e._UZ(63,"input",27,28),e.YNc(65,re,3,2,"div",18),e.qZA()(),e.TgZ(66,"div",12)(67,"div",13)(68,"label",14),e._uU(69,"Country*"),e.qZA(),e._UZ(70,"select",29,30),e.YNc(72,oe,2,0,"div",16),e.qZA(),e.TgZ(73,"div",13)(74,"label",14),e._uU(75,"City*"),e.qZA(),e._UZ(76,"select",31,32),e.YNc(78,ne,2,0,"div",16),e.qZA()(),e._UZ(79,"hr"),e.TgZ(80,"div",33)(81,"div",34)(82,"button",35),e._uU(83,"Save"),e.qZA()(),e.TgZ(84,"div",34)(85,"button",36),e.NdJ("click",function(){return r.onReset()}),e._uU(86,"Reset"),e.qZA()()()()()()()()),2&t&&(e.xp6(2),e.Q6J("routerLink",e.DdM(11,se)),e.xp6(11),e.Q6J("formGroup",r.fg_customer),e.xp6(6),e.Q6J("ngIf",r.first_name&&r.first_name.invalid&&(r.first_name.dirty||r.first_name.touched)),e.xp6(5),e.Q6J("ngIf",r.last_name&&r.last_name.invalid&&(r.last_name.dirty||r.last_name.touched)),e.xp6(6),e.Q6J("ngIf",r.email&&r.email.invalid&&(r.email.dirty||r.email.touched)),e.xp6(11),e.Q6J("ngIf",r.address&&r.address.invalid&&(r.address.dirty||r.address.touched)),e.xp6(11),e.Q6J("ngIf",r.district&&r.district.invalid&&(r.district.dirty||r.district.touched)),e.xp6(6),e.Q6J("ngIf",r.phone&&r.phone.invalid&&(r.phone.dirty||r.phone.touched)),e.xp6(7),e.Q6J("ngIf",r.postal_code&&r.postal_code.invalid&&(r.postal_code.dirty||r.postal_code.touched)),e.xp6(7),e.Q6J("ngIf",r.country&&r.country.invalid&&(r.country.dirty||r.country.touched)&&(null==r.country.errors?null:r.country.errors.required)),e.xp6(6),e.Q6J("ngIf",r.city&&r.city.invalid&&(r.city.dirty||r.city.touched)&&(null==r.city.errors?null:r.city.errors.required)))},dependencies:[_.O5,u.yS,i._Y,i.Fj,i.EJ,i.JJ,i.JL,i.sg,i.u]}),o})()}]}];let ae=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[_.ez,u.Bz.forChild(ie)]}),o})();var le=l(4805);let de=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[_.ez,u.Bz,ae,i.UX,le.x]}),o})()}}]);